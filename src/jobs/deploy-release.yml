description: |
  Deploy a release version to Clojars if there is not SNAPSHOT in the version string.
executor: clojurecli
steps:
  - attach_workspace:
      at: /home/circleci
  - run:
      name: Install xmllint
      command: sudo apt-get install libxml2-utils
  - run:
      name: Deploy Snapshot to Clojars
      command: |
        VERSION=$(xmllint --xpath '/*[local-name()="project"]/*[local-name()="version"]/text()' pom.xml)
        if [[ ${VERSION} =~ .*-SNAPSHOT ]]; then
            clojure -A:deploy
        else
            exit 0
        fi
