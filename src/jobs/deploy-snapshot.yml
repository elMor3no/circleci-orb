description: |
  Deploy a snapshot version to Clojars if there is SNAPSHOT in the version string.
executor: clojurecli
steps:
  - attach_workspace:
      at: /home/circleci
  - run:
      name: Install xmllint
      command: sudo apt-get install libxml2-utils
  - run:
      name: Deploy Release to Clojars
      command: |
        VERSION=$(xmllint --xpath '/*[local-name()="project"]/*[local-name()="version"]/text()' pom.xml)
        if [[ ${VERSION} =~ .*-SNAPSHOT ]]; then
            exit 0
        else
            clojure -A:deploy
        fi
